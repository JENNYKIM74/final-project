<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hta.lecture.mapper.ClassMapper">

	<select id="getClassDetail" parameterType="int" resultType="com.hta.lecture.vo.Classes">
		select
			class_no				as no,
			class_title				as title,
			class_content			as content,
			class_difficultly		as difficultly,
			class_image				as image,
			class_video				as video,
			class_income			as income,
			class_period			as period,
			class_price				as price,
			class_discountprice		as discountPrice,
			class_permission		as permission,
			class_filter			as filter,
			class_status			as status,
			class_application_date	as applicationDate,
			class_open_date			as openDate,
			class_updated_date		as updatedDate,
			class_deleted_date		as deletedDate,
			class_total_count		as totalCount,
			class_total_time		as totalTime,
			class_isdeleted			as isDeleted,
			teacher_no				as teacherNo,
			b.category_no			as categoryNo
		from
			final_class_tb a, final_category_tb b
		where
			a.category_no = b.category_no and class_no = #{value}
	</select>
	
	<select id="getAllCourseInfo" parameterType="com.hta.lecture.web.form.Criteria" resultType="com.hta.lecture.dto.ClassCourseDto">
		select
			class_no 					as no,
			class_title 				as title,
			teacher_name				as name,
			class_price 				as price,
			class_discountprice 		as discountPrice,
			class_image 				as image,
			b.category_no				as categoryNo,
			b.category_name				as categoryName,
			b.category_par_no			as categoryParNo
		from 
         (
         select 
            row_number() over (order by class_no desc) rn, 
            A.*, B.*
         from
            final_class_tb A, final_teacher_tb B
         where
			A.teacher_no = B.teacher_no
			and (class_title like '%' || #{value} || '%')
         ) a, final_category_tb b
      where
         a.category_no = b.category_no
         and rn between #{beginIndex} and #{endIndex}
			
	</select>
	
	<select id="getClassSearch" parameterType="com.hta.lecture.web.form.Criteria" resultType="com.hta.lecture.vo.Classes">
		select
			class_no				as no,
			class_title				as title,
			class_content			as content,
			class_difficultly		as difficultly,
			class_image				as image,
			class_video				as video,
			class_income			as income,
			class_period			as period,
			class_price				as price,
			class_discountprice		as discountPrice,
			class_permission		as permission,
			class_filter			as filter,
			class_status			as status,
			class_application_date	as applicationDate,
			class_open_date			as openDate,
			class_updated_date		as updatedDate,
			class_deleted_date		as deletedDate,
			class_total_count		as totalCount,
			class_total_time		as totalTime,
			class_isdeleted			as isDeleted,
			teacher_no				as teacherNo,
			category_no				as categoryNo
		from 
         (
         select 
            row_number() over (order by class_no desc) rn, 
            A.*
         from
            final_class_tb A
         <where>
            <if test="value != null">
				class_title like '%' || #{value} || '%'
            </if>
         </where>
         )
      where
         rn between #{beginIndex} and #{endIndex}
	</select>
	
	<select id="getClassesTotalRows" parameterType="com.hta.lecture.web.form.Criteria" resultType="int">
		select count(*)
		from final_class_tb
		<where>
			<if test="value != null">
				class_title like '%' || #{value} || '%'
			</if>
		</where>			
	</select>
	
	<select id="getAllClassCategories" resultType="com.hta.lecture.vo.Category">
		select
		    category_no 										as no,
		    category_name 										as name,
		    category_par_no 									as parentNo,
		    category_grade 										as grade
		from final_category_tb
		where category_par_no is null
	</select>
	
	<select id="getAllSubCategories" parameterType="int" resultType="com.hta.lecture.vo.Category">
		select
		    category_no 										as no,
		    category_name 										as name,
		    category_par_no 									as parentNo,
		    category_grade 										as grade
		from final_category_tb
		where category_par_no = #{value}
	</select>
	
	
	
	
	
	
	<!-- 
		(select class_no, count(*) cnt
		from final_progress_tb
		group by class_no) S,
		(select class_no, ceil(AVG(review_grade)) cnt
		from final_review_tb
		group by class_no) R,
		(select class_no, count(*) cnt
		from final_review_tb
		group by class_no) RC
	 -->
</mapper>